<!DOCTYPE html>
<html>
<head>
    <title>Mrd9483 Chess Games</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .game { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .stats { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .recent { background: #e8f4fd; }
        .won { background: #e8fdea; }
        .lost { background: #f4e8e8; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Mrd9483 Chess Games</h1>
    <div id="stats" class="stats">Loading statistics...</div>
    <div id="games">Loading games...</div>

    <script>
        async function loadGames() {
            try {
                const currentMonth = new Date().toISOString().slice(0, 7);
                const response = await fetch(`./data/games-${currentMonth}.json`);
                const data = await response.json();
                
                displayStats(data);
                displayGames(data.games || []);
            } catch (error) {
                document.getElementById('games').innerHTML = 'Error loading games: ' + error;
            }
        }
        
        function displayStats(data) {
            const games = data.games || [];
            const wins = games.filter(g => 
                (g.white.username === 'Mrd9483' && g.white.result === 'win') ||
                (g.black.username === 'Mrd9483' && g.black.result === 'win')
            ).length;
            
            const totalGames = games.length;
            const winRate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) : 0;
            
            document.getElementById('stats').innerHTML = `
                <h3>This Month: ${totalGames} games, ${wins} wins (${winRate}%)</h3>
                <p>Last updated: ${new Date().toLocaleString()}</p>
            `;
        }
        
        function displayGames(games) {
            const recentGames = games.slice(-20).reverse(); // Last 20 games
            const gamesHtml = recentGames.map((game, index) => {
                const isRecent = index < 3;
                const isWhite = game.white.username === 'Mrd9483';
                const myColor = isWhite ? 'white' : 'black';
                const opponentColor = isWhite ? 'black' : 'white';
                const myResult = game[myColor].result;
                const opponentUsername = game[opponentColor].username;
                const myRating = game[myColor].rating;
                const opponentRating = game[opponentColor].rating;

                return `
                    <div class="game ${isRecent ? 'recent' : ''} ${myResult === 'win' ? 'won' : 'lost'}">
                        <h4>vs ${opponentUsername} (I played ${myColor}) - ${myResult}</h4>
                        <p>Time: ${game.time_class}, My Rating: ${myRating}, Opponent Rating: ${opponentRating}</p>
                        <details>
                            <summary>PGN</summary>
                            <pre>${game.pgn}</pre>
                        </details>
                    </div>
                `;
            }).join('');
            
            document.getElementById('games').innerHTML = `
                <h3>Recent Games</h3>
                ${gamesHtml}
            `;
        }
        
        loadGames();
    </script>
</body>
</html>